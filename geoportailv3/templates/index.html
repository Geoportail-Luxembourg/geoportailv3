## -*- coding: utf-8 -*-
<%
    settings = request.registry.settings
    proxy_wms_url = settings.get('proxy_wms_url')
    node_modules_path = settings.get('node_modules_path')
    closure_library_path = settings.get('closure_library_path')
%>\
<!DOCTYPE html>
<html lang={{mainCtrl.lang}} ng-app="app" ng-controller="MainController as mainCtrl">
  <head>
  <title ng-bind-template="{{ mainCtrl.getCurrentTheme()|translate }}{{ ' - Geoportal Luxembourg'|translate}}"></title>
    <meta charset="utf-8">
    <meta name="viewport"
          content="initial-scale=1.0, user-scalable=no, width=device-width">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="icon" href="${request.static_url('geoportailv3:static/images/favicon.ico')}" />
% if debug:
    <link rel="stylesheet" href="${request.static_url('geoportailv3:static/build/build.css')}" type="text/css">
% else:
    <link rel="stylesheet" href="${request.static_url('geoportailv3:static/build/build.min.css')}" type="text/css">
    % endif
    <!-- Remove ribbon css and element for final prod version -->
    <style>
      /* The ribbons */
      .corner-ribbon{
        width: 155px;
        background: #e43;
        position: absolute;
        top: 10px;
        left: -50px;
        text-align: center;
        line-height: 40px;
        letter-spacing: 1px;
        color: #f0f0f0;
        transform: rotate(-45deg);
        -webkit-transform: rotate(-45deg);
        cursor: default;
        -moz-user-select: none;
        -webkit-user-select: none;
        -ms-user-select: none;
      }
      .corner-ribbon:hover {
        opacity: 0.3;
      }

      /* Custom styles */
      .corner-ribbon.sticky{
        position: fixed;
      }

      .corner-ribbon.shadow{
        box-shadow: 0 0 3px rgba(0,0,0,.3);
      }

      /* Colors */
      .corner-ribbon.orange{background: #e82;}
    </style>
  </head>
  <body data-theme="{{mainCtrl.getCurrentTheme()}}" ng-class="mainCtrl.mobileSearchActive ? 'search-mobile' : ''">
    <!-- Begin fixed top bar -->
    <header class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container-fluid">
  <div class="corner-ribbon top-left sticky orange shadow " translate>Preview</div>
        <div class="navbar-inner">
          <div class="pull-left brand">
            <img src="//cdn.public.lu/skizz/govbar/logos/gov-light.png" alt="Gouvernement du Grand-Duché de Luxembourg">
          </div>
        </div>

        <ul class="nav navbar-nav pull-right">
          <li class="visible-xs-inline-block search icon" ng-click="mainCtrl.mobileSearchActive = true"><a href translate>search</a></li>
          <li class="user icon" ng-class="mainCtrl.userOpen ? 'active': ''">
            <a href translate ngeo-btn ng-model="mainCtrl.userOpen" ng-click="mainCtrl.languageOpen = false">user</a>
            <app-authentication app-authentication-lang="mainCtrl.lang"></app-authentication>
          </li>


          <li class="lang icon" ng-class="mainCtrl.languageOpen ? 'active': ''">
            <a href translate ngeo-btn ng-model="mainCtrl.languageOpen"  ng-click="mainCtrl.userOpen = false">lang</a>
            <ul class="nav toolbox-panel toolbox-panel-top">
              <li ng-class="{active: mainCtrl.lang == 'lb'}">
                <a href ng-click="mainCtrl.switchLanguage('lb');mainCtrl.languageOpen = false">lu</a>
              </li>
              <li ng-class="{active: mainCtrl.lang == 'fr'}">
                <a href ng-click="mainCtrl.switchLanguage('fr');mainCtrl.languageOpen = false">fr</a>
              </li>
              <li ng-class="{active: mainCtrl.lang == 'de'}">
                <a href ng-click="mainCtrl.switchLanguage('de');mainCtrl.languageOpen = false">de</a>
              </li>
              <li ng-class="{active: mainCtrl.lang == 'en'}">
                <a href ng-click="mainCtrl.switchLanguage('en');mainCtrl.languageOpen = false">en</a>
              </li>
            </ul>
          </li>
        </ul>
        <app-search app-search-map="::mainCtrl.map" app-search-language="mainCtrl.lang" app-search-mobileactive="mainCtrl.mobileSearchActive"></app-search>
        <div class="icon theme-icon pull-right" ng-click="mainCtrl.toggleThemeSelector();"></div>
      </div>
    </header>

    <!-- Begin page content (ie. map + left sidebar) -->
    <div id="main-container">
      <div id="sidebar" ng-class="{open: mainCtrl.sidebarOpen()}"
           app-resizemap="mainCtrl.map" app-resizemap-state="mainCtrl.sidebarOpen()">

        <!-- Layers -->
        <div id="layers" ng-class="mainCtrl.layersOpen ? 'show' : 'hide'">
          <h2 translate>layers</h2>
          <button class="close-panel" ng-click="mainCtrl.closeSidebar()">
            ✕
          </button>
          <app-backgroundlayer app-backgroundlayer-map="::mainCtrl.map"></app-backgroundlayer>
          <ul class="nav nav-tabs">
            <li role="presentation" class="active">
            <a href="#mylayers" data-toggle="tab">
              <span translate>my_layers</span>
              <span ng-if="mainCtrl.selectedLayers.length > 0">({{mainCtrl.selectedLayers.length}})</span>
              </a>
            </li>
            <li role="presentation">
              <a href="#catalog" data-toggle="tab" translate>Catalog</a>
            </li>
          </ul>
          <div class="tab-content">
            <div id="mylayers" class="tab-pane active col-xs-12">
              <app-layermanager app-layermanager-map="::mainCtrl.map"
                app-layermanager-layers="::mainCtrl.selectedLayers">
              </app-layermanager>
              <div class="text-center">
                <button class="btn btn-default" ng-click="mainCtrl.showTab('a[href=#catalog]');" translate>+ Add layers</button>
              </div>
            </div>
            <div id="catalog" class="tab-pane">
              <app-themeswitcher app-themeswitcher-useropen="mainCtrl.userOpen"></app-themeswitcher>
              <app-catalog app-catalog-map="::mainCtrl.map"></app-catalog>
            </div>
          </div>
        </div>

        <!-- MyMaps -->
        <div id="mymaps" class="mymaps" ng-class="mainCtrl.mymapsOpen ? 'show' : 'hide'">
          <h2 translate>my_maps</h2>
          <button class="close-panel" ng-click="mainCtrl.closeSidebar()">
            ✕
          </button>
          <app-mymaps app-mymaps-useropen="mainCtrl.userOpen"
                      app-mymaps-drawopen="mainCtrl.drawOpen"
                      app-mymaps-layers-changed="mainCtrl.layersChanged"
                      app-mymaps-selected-layers="mainCtrl.selectedLayers"
                      app-mymaps-map="::mainCtrl.map"></app-mymaps>
        </div>

        <!-- Infos -->
        <div id="infos" ng-class="mainCtrl.infosOpen ? 'show' : 'hide'">
          <h2 translate>infos</h2>
          <button class="close-panel" ng-click="mainCtrl.closeSidebar()">
            ✕
          </button>
          <div class="container-fluid">
            <app-query app-query-map="::mainCtrl.map"
                       app-query-open="mainCtrl.infosOpen"
                       app-query-appselector="mainCtrl.infosAppSelector"
                       app-query-Active="mainCtrl.queryActive"
                       app-query-language="mainCtrl.lang"></app-query>
            <app-locationinfo app-locationinfo-map="::mainCtrl.map"
                              app-locationinfo-open="mainCtrl.infosOpen"
                              app-locationinfo-appselector="mainCtrl.infosAppSelector">
            </app-locationinfo>
            <div class="row" ng-show="mainCtrl.infosAppSelector === undefined">
              <div class="col-xs-12">
                <ul>
                  <li translate>
                  A <em>right click</em> (tap and hold on mobile) will display information about the current location.
                  </li>
                  <li translate>
                  A <em>short click</em> (tap on mobile) on a map feature will select the feature and show more information.
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
      <app-map app-map-map="::mainCtrl.map"></app-map>
    </div>
    <!-- Begin bottom bar -->
    <footer class="footer">
      <ul class="sidebar-controls nav navbar-nav pull-left"
          ng-class="{open: mainCtrl.sidebarOpen()}" ngeo-btn-group>
        <li ngeo-btn ng-model="mainCtrl.layersOpen" class="layers icon">
          <a href translate>Couches</a>
        </li>
        <li ngeo-btn ng-model="mainCtrl.mymapsOpen" class="mymaps icon">
          <a href translate>My Maps<span ng-show="mainCtrl.layersChanged">(*)</span></a>
        </li>
        <li ngeo-btn ng-model="mainCtrl.infosOpen" class="infos icon">
          <a href translate>Infos</a>
        </li>
      </ul>
      <ul class="footer-navigation nav navbar-nav pull-right hidden-xs">
        <li><a ng-href="https://www.geoportail.lu/{{mainCtrl.lang}}/propos/" translate>A Propos</a></li>
        <li><a ng-href="https://www.geoportail.lu/{{mainCtrl.lang}}/documentation/" translate>Aide</a></li>
        <li><a ng-href="https://www.geoportail.lu/{{mainCtrl.lang}}/propos/contactez-nous/" translate>Contact</a></li>
        <li><a ng-href="https://www.geoportail.lu/{{mainCtrl.lang}}/propos/mentions-legales/" translate>Legalites</a></li>
        <li><a ng-href="http://www.act.public.lu/">ACT</a></li>
      </ul>
      <ul class="toolbox nav navbar-nav" ngeo-btn-group>
        <li class="hidden-xs draw icon" ng-class="mainCtrl.drawOpen ? 'active' : ''">
        <a href translate ngeo-btn ng-model="mainCtrl.drawOpen">Dessin</a>
          <app-draw app-draw-map="::mainCtrl.map"
            app-draw-active="mainCtrl.drawOpen"
            app-draw-queryactive="mainCtrl.queryActive"
            app-draw-mymaps-open="mainCtrl.mymapsOpen">
          </app-draw>
        </li>
        <li class="hidden-xs measure icon" ng-class="mainCtrl.measureOpen ? 'active' : ''">
        <a href translate ngeo-btn ng-model="mainCtrl.measureOpen">Mesurer</a>
          <app-measure app-measure-map="::mainCtrl.map"
            app-measure-active="mainCtrl.measureOpen" app-profile-data="mainCtrl.profileData"
            app-profile-open="mainCtrl.profileOpen"
            app-measure-queryactive="mainCtrl.queryActive">
          </app-measure>
        </li>
        <li class="hidden-xs print icon" ng-class="mainCtrl.printOpen ? 'active' : ''">
          <a href translate ngeo-btn ng-model="mainCtrl.printOpen">Imprimer</a>
          <app-print app-print-map="::mainCtrl.map"
            app-print-open="mainCtrl.printOpen" app-print-layers="::mainCtrl.selectedLayers"></app-print>
        </li>
        <li class="hidden-xs share icon" ng-class="mainCtrl.shareOpen ? 'active' : ''">
          <a href translate ngeo-btn ng-model="mainCtrl.shareOpen">Partager</a>
          <app-share app-share-active="mainCtrl.shareOpen"></app-share>
        </li>
      </ul>
    </footer>
% if debug:
    <script>
      // We should really use the empty string for CLOSURE_BASE_PATH for there
      // is a bug in Closure Library preventing us from doing it. See
      // <https://github.com/google/closure-library/pull/418>.
      window.CLOSURE_BASE_PATH = ' ';
      window.CLOSURE_NO_DEPS = true;
    </script>
    <script src="${request.static_url('%s/proj4/dist/proj4-src.js' % node_modules_path)}"></script>
    <script src="${request.static_url('%s/jquery/dist/jquery.js' % node_modules_path)}"></script>
    <script src="${request.static_url('%s/angular/angular.js' % node_modules_path)}"></script>
    <script src="${request.static_url('%s/angular-gettext/dist/angular-gettext.js' % node_modules_path)}"></script>
    <script src="${request.static_url('%s/closure/goog/base.js' % closure_library_path)}"></script>
    <script src="${request.static_url('%s/bootstrap/dist/js/bootstrap.js' % node_modules_path)}"></script>
    <script src="${request.route_url('deps.js')}"></script>
    <script src="${request.static_url('geoportailv3:static/js/main.js')}"></script>
    <script src="${request.static_url('%s/ngeo/utils/watchwatchers.js' % node_modules_path)}"></script>
    <script src="${request.static_url('%s/d3/d3.min.js' % node_modules_path)}"></script>
    <script src="${request.static_url('%s/typeahead.js/dist/typeahead.bundle.js' % node_modules_path)}"></script>
    <script src="${request.static_url('%s/fuse.js/src/fuse.js' % node_modules_path)}"></script>
    <script src="${request.static_url('geoportailv3:static/build/templatecache.js')}"></script>
% else:
    <script src="${request.static_url('geoportailv3:static/build/build.js')}"></script>
% endif
    <script>
      (function() {
         var appModule = angular.module('app');
         appModule.constant('langUrls', {
           'fr': '${request.static_url('geoportailv3:static/build/locale/fr/geoportailv3.json')}',
           'en': '${request.static_url('geoportailv3:static/build/locale/en/geoportailv3.json')}',
           'de': '${request.static_url('geoportailv3:static/build/locale/de/geoportailv3.json')}',
           'lb': '${request.static_url('geoportailv3:static/build/locale/lb/geoportailv3.json')}'
         });
% if proxy_wms_url:
         appModule.constant('proxyWmsUrl', "${proxy_wms_url}");
         appModule.constant('remoteProxyWms', true);
% else:
         appModule.constant('proxyWmsUrl', "${request.route_url('wms')}");
         appModule.constant('remoteProxyWms', false);
% endif
         appModule.constant('mymapsMapsUrl', "${request.route_url('mymaps_getmaps')}");
         appModule.constant('mymapsUrl', "${request.route_url('mymaps')}");
         appModule.constant('mymapsImageUrl', "${request.route_url('mymaps_image')}");
         appModule.constant('treeUrl', "${request.route_url('themes', _query={'version': 2, 'min_levels': 1, 'catalogue': 'true', 'interface': 'desktop', 'background': 'bglayers'})}");
         appModule.constant('loginUrl', "${request.route_url('login')}");
         appModule.constant('logoutUrl', "${request.route_url('logout')}");
         appModule.constant('getuserinfoUrl', "${request.route_url('getuserinfo')}");
         appModule.constant('elevationServiceUrl', "${request.route_url('raster')}");
         appModule.constant('profileServiceUrl', "${request.route_url('profile.json')}");
         appModule.constant('searchServiceUrl', "${request.route_url('fulltextsearch')}");
         appModule.constant('printServiceUrl', "${request.route_url('printproxy')}");
         appModule.constant('shorturlServiceUrl', "${request.route_url('shortener_create')}");
         appModule.constant('getInfoServiceUrl', "${request.route_url('getfeatureinfo')}");
         appModule.constant('getRemoteTemplateServiceUrl', "${request.route_url('getremotetemplate')}");
         appModule.constant('isThemePrivateUrl', "${request.route_url('isthemeprivate')}");
         appModule.constant('qrServiceUrl', "${request.route_url('qr')}");
         appModule.constant('downloadmeasurementUrl', "${request.route_url('download_measurement')}");
         appModule.constant('downloadsketchUrl', "${request.route_url('download_sketch')}");
         appModule.constant('exportgpxkmlUrl', "${request.route_url('exportgpxkml')}");
         appModule.constant('defaultExtent', [267000, 6000000, 980000, 6700000]);
         appModule.constant('maxExtent', [2.4, 47.5, 8.8, 51.2]);

         appModule.value('appQueryTemplatesPath', '${request.static_url('geoportailv3:static/js/query/')}');
         appModule.value('ngeoLayertreeTemplateUrl', 'catalog/layertree.html');
         appModule.value('ngeoPopupTemplateUrl', 'layerinfo/popup.html');
         appModule.value('ngeoScaleselectorTemplateUrl', 'infobar/scaleselector.html');
         appModule.value('appBackgroundlayerTemplateUrl', 'backgroundlayer/backgroundlayer.html');
         appModule.value('appLayermanagerTemplateUrl', 'layermanager/layermanager.html');
         appModule.value('appMeasureTemplateUrl', 'measure/measure.html');
         appModule.value('appDrawTemplateUrl', 'draw/draw.html');
         appModule.value('appFeaturePopupTemplateUrl', 'draw/featurepopup.html');
         appModule.value('appStyleEditingTemplateUrl', 'draw/styleediting.html');
         appModule.value('appSymbolSelectorTemplateUrl', 'draw/symbolselector.html');
         appModule.value('appLayerinfoTemplateUrl', 'layerinfo/layerinfo.html');
         appModule.value('appAuthenticationTemplateUrl', 'authentication/authentication.html');
         appModule.value('appInfobarTemplateUrl', 'infobar/infobar.html');
         appModule.value('appProjectionselectorTemplateUrl', 'infobar/projectionselector.html');
         appModule.value('appMapTemplateUrl', 'map/map.html');
         appModule.value('appThemeswitcherTemplateUrl', 'themeswitcher/themes.html');
         appModule.value('appProfileTemplateUrl', 'profile/profile.html');
         appModule.value('appPrintTemplateUrl', 'print/print.html');
         appModule.value('appSearchTemplateUrl', 'search/search.html');
         appModule.value('appShareTemplateUrl', 'share/share.html');
         appModule.value('appShorturlTemplateUrl', 'share/shorturl.html');
         appModule.value('appQueryTemplateUrl', 'query/info.html');
         appModule.value('appLocationinfoTemplateUrl', 'locationinfo/locationinfo.html');
         appModule.value('appMymapsTemplateUrl', 'mymaps/mymaps.html');
       })();
    </script>
    <!-- Piwik -->
      <script type="text/javascript">
        var _paq = _paq || [];
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
          var u="//statistics.geoportail.lu/";
          _paq.push(['setTrackerUrl', u+'piwik.php']);
          _paq.push(['setSiteId', 18]);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
        })();
      </script>
      <noscript><p><img src="//statistics.geoportail.lu/piwik.php?idsite=18" style="border:0;" alt="" /></p></noscript>
    <!-- End Piwik Code -->

  </body>
</html>
